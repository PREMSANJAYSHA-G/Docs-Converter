<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Docs Converter</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin:0; padding:0; }
body {
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #ff6a00, #ee0979, #6a11cb, #2575fc);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
}
@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.container {
    width: 90%;
    max-width: 500px;
    padding: 40px 30px;
    background: rgba(255, 255, 255, 0.85);
    border-radius: 25px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    backdrop-filter: blur(10px);
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 20px;
}
h2 { font-size: 28px; font-weight: 600; color: #4a148c; }
.upload-wrapper { display: flex; flex-direction: column; align-items: center; }
.upload-box {
    width: 100%;
    border: 3px dashed #6a1b9a;
    border-radius: 20px;
    padding: 40px 20px;
    background: rgba(255,255,255,0.5);
    cursor: pointer;
    transition: 0.3s;
    color: #6a1b9a;
    text-align: center;
}
.upload-box:hover { background: rgba(255,255,255,0.9); transform: scale(1.03); }
.upload-box p { margin: 8px 0; font-size: 16px; color: #333; }
#fileList {
    margin-top: 15px;
    text-align: left;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.file-badge {
    background: linear-gradient(135deg, #ff512f, #dd2476);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
}
.file-badge button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    font-weight: bold;
}
input[type="file"] { display: none; }
.btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 50px;
    background: linear-gradient(90deg, #ff512f, #dd2476);
    color: white;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
}
.btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
@media (max-width: 500px) {
    .container { padding: 30px 20px; }
    h2 { font-size: 24px; }
}
</style>
</head>
<body>

<div class="container">
    <h2>ðŸ“„ Docs Converter</h2>
    <form id="uploadForm" action="/convert" method="POST" enctype="multipart/form-data">
        <div class="upload-wrapper">
            <label for="files" class="upload-box" id="dropArea">
                <p>Drag & Drop your Word / PDF files anywhere on page</p>
                <p><strong>or click to upload</strong></p>
            </label>
            <input type="file" id="files" multiple>
            <div id="fileList"></div>
        </div>
        <button type="submit" class="btn">Convert All ðŸ”„</button>
    </form>
</div>

<script>
const dropArea = document.getElementById("dropArea");
const inputFile = document.getElementById("files");
const fileList = document.getElementById("fileList");
const uploadForm = document.getElementById("uploadForm");

let selectedFiles = []; // Store all selected files

// Handle clicks & drag events on dropArea
dropArea.addEventListener("click", e => { e.preventDefault(); inputFile.click(); });
inputFile.addEventListener("change", e => handleNewFiles(e.target.files));

// Make the **whole page** a drop target
document.addEventListener("dragover", function(e) {
    e.preventDefault();
    dropArea.style.background = "rgba(255,255,255,0.9)";
});
document.addEventListener("dragleave", function(e) {
    e.preventDefault();
    dropArea.style.background = "rgba(255,255,255,0.5)";
});
document.addEventListener("drop", function(e) {
    e.preventDefault();
    handleNewFiles(e.dataTransfer.files);
    dropArea.style.background = "rgba(255,255,255,0.5)";
});

// Add new files to selectedFiles array
function handleNewFiles(files) {
    for (let i = 0; i < files.length; i++) {
        if (!selectedFiles.some(f => f.name === files[i].name && f.size === files[i].size)) {
            selectedFiles.push(files[i]);
        }
    }
    updateFileList();
}

// Update UI and add remove buttons
function updateFileList() {
    fileList.innerHTML = "";
    selectedFiles.forEach((file, index) => {
        const span = document.createElement("span");
        span.className = "file-badge";
        span.textContent = file.name;

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "âœ–";
        removeBtn.addEventListener("click", () => {
            selectedFiles.splice(index, 1); // remove file
            updateFileList();
        });

        span.appendChild(removeBtn);
        fileList.appendChild(span);
    });
}

// Handle form submit
uploadForm.addEventListener("submit", e => {
    e.preventDefault();
    if(selectedFiles.length === 0){
        alert("Please select at least one file to convert.");
        return;
    }

    const formData = new FormData();
    selectedFiles.forEach(file => formData.append("files[]", file));

    fetch("/convert", { method: "POST", body: formData })
    .then(resp => resp.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = selectedFiles.length > 1 ? "converted_files.zip" : selectedFiles[0].name.split(".")[0] + (selectedFiles[0].name.endsWith(".pdf") ? ".docx" : ".pdf");
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        // Reset selection after download
        selectedFiles = [];
        updateFileList();
        inputFile.value = "";
    });
});
</script>

</body>
</html>
